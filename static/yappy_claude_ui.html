<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yappy - AI Agent Assistant</title>
    
    <!-- Tailwind CSS via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React and dependencies -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    
    <!-- Custom Tailwind Config -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'dark-bg': '#0f0f0f',
                        'dark-secondary': '#1a1a1a',
                        'dark-tertiary': '#262626',
                        'orange-accent': '#ff6b35',
                        'text-primary': '#ffffff',
                        'text-secondary': '#a1a1a1',
                    },
                    fontFamily: {
                        'serif': ['Georgia', 'serif'],
                        'sans': ['Inter', 'system-ui', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    
    <style>
        /* Custom styles for smooth transitions */
        * {
            transition: all 0.2s ease;
        }
        
        /* Prevent horizontal scroll on mobile */
        html, body {
            overflow-x: hidden;
            max-width: 100%;
        }
        
        /* Improve touch targets on mobile */
        @media (max-width: 768px) {
            button, input, select, textarea {
                min-height: 44px;
            }
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #1a1a1a;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #333;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        
        /* Dropdown animation */
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .dropdown-enter {
            animation: slideDown 0.2s ease-out;
        }
        
        /* Starburst decoration */
        .starburst {
            position: relative;
            display: inline-block;
            color: #ff6b35;
            font-size: 1.5rem;
        }
        
        .starburst::before {
            content: 'âœ¦';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(45deg);
        }
        
        /* Loading dots animation */
        @keyframes bounce {
            0%, 80%, 100% {
                transform: scale(0);
                opacity: 0.5;
            }
            40% {
                transform: scale(1);
                opacity: 1;
            }
        }
        
        .loading-dot {
            animation: bounce 1.4s ease-in-out infinite;
        }
        
        .loading-dot:nth-child(2) {
            animation-delay: 0.16s;
        }
        
        .loading-dot:nth-child(3) {
            animation-delay: 0.32s;
        }
    </style>
</head>
<body class="bg-dark-bg text-text-primary min-h-screen">
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        
        // Main App Component
        function App() {
            // State management
            const [username, setUsername] = useState('there'); // Default fallback
            const [inputValue, setInputValue] = useState('');
            const [selectedModel, setSelectedModel] = useState('Claude 3.5 Sonnet');
            const [messages, setMessages] = useState([]);
            const [isLoading, setIsLoading] = useState(false);
            const [activeDropdown, setActiveDropdown] = useState(null);
            const [isAuthenticated, setIsAuthenticated] = useState(false);
            const [authToken, setAuthToken] = useState(null);
            const [uploadedFiles, setUploadedFiles] = useState([]);
            const [fileContext, setFileContext] = useState({});
            const [conversationContext, setConversationContext] = useState([]);
            const [currentAgent, setCurrentAgent] = useState(null);
            
            const messagesEndRef = useRef(null);
            const fileInputRef = useRef(null);
            
            // Check authentication on mount
            useEffect(() => {
                const token = localStorage.getItem('yappy_token');
                const savedUsername = localStorage.getItem('yappy_username');
                if (token && savedUsername) {
                    setIsAuthenticated(true);
                    setAuthToken(token);
                    setUsername(savedUsername);
                }
            }, []);
            
            // Auto scroll to bottom
            useEffect(() => {
                messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
            }, [messages]);
            
            // Get greeting based on time
            const getGreeting = () => {
                const hour = new Date().getHours();
                if (hour < 12) return "Good morning";
                if (hour < 18) return "Good afternoon";
                return "Good evening";
            };
            
            // Agent mapping
            const agentMap = {
                'Write': 'Writing Agent',
                'Learn': 'Research Agent',
                'Code': 'Code Agent',
                'Anything': 'Casual Agent'
            };
            
            // Full agent names for display
            const agentDisplayNames = {
                'Writing Agent': 'Writing Agent',
                'Research Agent': 'Research Agent',
                'Code Agent': 'Code Agent',
                'Casual Agent': 'Casual Agent',
                'Travel Agent': 'Travel Agent',
                'File Agent': 'File Agent',
                'Browser Agent': 'Browser Agent'
            };
            
            // Dropdown options
            const dropdownOptions = {
                'Write': [
                    'Blog Post about AI',
                    'Creative Story Starter',
                    'Product Description for App'
                ],
                'Learn': [
                    'Explain Quantum Computing',
                    'Learn Basic Python',
                    'What is Inflation?'
                ],
                'Code': [
                    'Create a To-Do App in React',
                    'Debug a Python Script',
                    'Write SQL for a Join Query'
                ],
                'Anything': [
                    'Give me life advice',
                    'Plan a healthy meal',
                    'Recommend a movie'
                ]
            };
            
            // Model options
            const modelOptions = [
                'Claude 3.5 Sonnet',
                'GPT-4 Turbo',
                'Gemini 1.5 Pro',
                'Llama 3.1'
            ];
            
            // Handle dropdown selection
            const handleDropdownSelect = async (category, option) => {
                setActiveDropdown(null);
                setInputValue(option);
                
                // Simulate sending message
                await handleSend(option, agentMap[category]);
            };
            
            // Handle file upload
            const handleFileUpload = async (event) => {
                const files = Array.from(event.target.files);
                if (!files.length) return;
                
                for (const file of files) {
                    const reader = new FileReader();
                    
                    reader.onload = async (e) => {
                        const fileData = {
                            name: file.name,
                            size: file.size,
                            type: file.type,
                            content: e.target.result,
                            id: Date.now() + Math.random()
                        };
                        
                        setUploadedFiles(prev => [...prev, fileData]);
                        setFileContext(prev => ({
                            ...prev,
                            [fileData.id]: fileData
                        }));
                        
                        // Add message about file upload
                        const uploadMessage = {
                            id: Date.now(),
                            type: 'system',
                            content: `File uploaded: ${file.name} (${(file.size / 1024).toFixed(2)} KB)`,
                            timestamp: new Date(),
                            fileId: fileData.id
                        };
                        
                        setMessages(prev => [...prev, uploadMessage]);
                    };
                    
                    if (file.type.includes('image')) {
                        reader.readAsDataURL(file);
                    } else {
                        reader.readAsText(file);
                    }
                }
                
                // Clear the input
                event.target.value = '';
            };
            
            // Handle send message
            const handleSend = async (messageText = inputValue, agentType = null, attachedFile = null) => {
                if (!messageText.trim()) return;
                
                // Add user message
                const userMessage = {
                    id: Date.now(),
                    type: 'user',
                    content: messageText,
                    timestamp: new Date(),
                    attachedFile: attachedFile
                };
                
                setMessages(prev => [...prev, userMessage]);
                setInputValue('');
                setIsLoading(true);
                
                try {
                    // Determine which agent to use
                    let agent = agentType;
                    
                    // If this is a follow-up question and we have a current agent, use it
                    if (!agent && currentAgent && conversationContext.length > 0) {
                        agent = currentAgent;
                    }
                    
                    if (!agent) {
                        // Check if message references uploaded files
                        const lowerMessage = messageText.toLowerCase();
                        const hasFileReference = uploadedFiles.some(file => 
                            lowerMessage.includes(file.name.toLowerCase()) || 
                            lowerMessage.includes('file') || 
                            lowerMessage.includes('document') ||
                            lowerMessage.includes('image') ||
                            lowerMessage.includes('uploaded')
                        );
                        
                        if (hasFileReference && uploadedFiles.length > 0) {
                            // Route based on file type if referencing files
                            const referencedFile = uploadedFiles[uploadedFiles.length - 1];
                            if (referencedFile) {
                                if (referencedFile.name.match(/\.(js|jsx|ts|tsx|py|java|cpp|c|go|rs|sql)$/i)) {
                                    agent = 'Code Agent';
                                } else if (referencedFile.type.includes('image')) {
                                    agent = 'Casual Agent';
                                } else if (referencedFile.name.match(/\.(txt|md|doc|docx)$/i)) {
                                    agent = 'Writing Agent';
                                } else if (referencedFile.name.match(/\.(csv|json|xml)$/i)) {
                                    agent = 'Research Agent';
                                } else {
                                    agent = 'File Agent';
                                }
                            }
                        } else {
                            // Standard routing
                            if (lowerMessage.includes('travel') || lowerMessage.includes('trip') || lowerMessage.includes('vacation')) {
                                agent = 'Travel Agent';
                            } else if (lowerMessage.includes('write') || lowerMessage.includes('blog') || lowerMessage.includes('story')) {
                                agent = 'Writing Agent';
                            } else if (lowerMessage.includes('learn') || lowerMessage.includes('explain') || lowerMessage.includes('what is')) {
                                agent = 'Research Agent';
                            } else if (lowerMessage.includes('code') || lowerMessage.includes('debug') || lowerMessage.includes('sql') || lowerMessage.includes('program')) {
                                agent = 'Code Agent';
                            } else {
                                agent = 'Casual Agent';
                            }
                        }
                    }
                    
                    // Set current agent for follow-up questions
                    setCurrentAgent(agent);
                    
                    // Add routing message
                    const routingMessage = {
                        id: Date.now() + 0.5,
                        type: 'system',
                        content: `Routing you to ${agent}...`,
                        timestamp: new Date()
                    };
                    setMessages(prev => [...prev, routingMessage]);
                    
                    // If authenticated, make real API call
                    if (isAuthenticated && authToken) {
                        const payload = {
                            message: messageText,
                            model_name: selectedModel.toLowerCase().includes('claude') ? 'anthropic' : 
                                       selectedModel.toLowerCase().includes('gpt') ? 'openai' :
                                       selectedModel.toLowerCase().includes('gemini') ? 'google' : 'openai'
                        };
                        
                        // Include file context if available
                        if (attachedFile) {
                            payload.file_context = {
                                name: attachedFile.name,
                                type: attachedFile.type,
                                content: attachedFile.content
                            };
                        } else if (uploadedFiles.length > 0) {
                            // Include all uploaded files as context
                            payload.uploaded_files = uploadedFiles.map(f => ({
                                name: f.name,
                                type: f.type,
                                content: f.content.substring(0, 10000) // Limit content size
                            }));
                        }
                        
                        const response = await axios.post('/api/chat', payload, {
                            headers: { Authorization: `Bearer ${authToken}` }
                        });
                        
                        const aiMessage = {
                            id: Date.now() + 1,
                            type: 'ai',
                            agent: agentDisplayNames[response.data.agent_used] || agentDisplayNames[agent] || agent,
                            content: response.data.response,
                            timestamp: new Date()
                        };
                        
                        setMessages(prev => [...prev, aiMessage]);
                        
                        // Update conversation context for follow-ups
                        setConversationContext(prev => [...prev, {
                            user: messageText,
                            ai: response.data.response,
                            agent: agent
                        }]);
                    } else {
                        // Simulate response
                        await simulateAgentResponse(agent, messageText, attachedFile);
                    }
                } catch (error) {
                    console.error('Error:', error);
                    const errorMessage = {
                        id: Date.now() + 1,
                        type: 'ai',
                        agent: 'System',
                        content: 'Sorry, I encountered an error. Please make sure you are logged in and have configured your API keys.',
                        timestamp: new Date()
                    };
                    setMessages(prev => [...prev, errorMessage]);
                } finally {
                    setIsLoading(false);
                }
            };
            
            // Simulate agent response
            const simulateAgentResponse = async (agent, message, attachedFile) => {
                // Simulate thinking delay
                await new Promise(resolve => setTimeout(resolve, 1500));
                
                // Mock responses based on agent type and file context
                let response = '';
                
                if (attachedFile) {
                    // File-specific responses
                    if (attachedFile.type.includes('image')) {
                        response = `I can see you've uploaded an image file "${attachedFile.name}". As a simulated response, I would analyze this image and describe its contents, identify objects, text, or patterns within it. The image appears to be ${(attachedFile.size / 1024).toFixed(2)} KB in size.`;
                    } else if (attachedFile.name.match(/\.(js|jsx|ts|tsx|py|java|cpp|c|go|rs|sql)$/i)) {
                        response = `I've analyzed the code file "${attachedFile.name}".\n\nThis appears to be a ${attachedFile.name.split('.').pop().toUpperCase()} file. I would review the code structure, identify potential improvements, check for bugs, and suggest optimizations. The file is ${(attachedFile.size / 1024).toFixed(2)} KB in size.`;
                    } else if (attachedFile.name.match(/\.(txt|md|doc|docx)$/i)) {
                        response = `I've reviewed the document "${attachedFile.name}".\n\nBased on the content, I would provide a summary of the main points, identify key themes, and offer insights about the document's purpose and structure. The document is ${(attachedFile.size / 1024).toFixed(2)} KB in size.`;
                    } else if (attachedFile.name.match(/\.(csv|json|xml)$/i)) {
                        response = `I've analyzed the data file "${attachedFile.name}".\n\nThis appears to be structured data in ${attachedFile.name.split('.').pop().toUpperCase()} format. I would examine the data structure, identify patterns, provide statistics, and suggest potential uses for this data. The file contains ${(attachedFile.size / 1024).toFixed(2)} KB of data.`;
                    } else {
                        response = `I've received the file "${attachedFile.name}" (${attachedFile.type || 'unknown type'}). I would analyze its contents and provide relevant insights based on the file type and content. The file is ${(attachedFile.size / 1024).toFixed(2)} KB in size.`;
                    }
                } else {
                    // Standard responses based on agent type
                    const responses = {
                        'Writing Agent': `I'll help you write that. Here's a creative start:\n\n"In the age of artificial intelligence, we stand at the crossroads of innovation and imagination. Every line of code written today shapes tomorrow's reality..."`,
                        'Research Agent': `Let me explain that for you:\n\nThe concept you're asking about is fascinating. It involves understanding the fundamental principles that govern how systems interact and evolve over time. Here are the key points to understand...`,
                        'Code Agent': `Here's a solution for your coding request:\n\n\`\`\`javascript\nfunction TodoApp() {\n  const [todos, setTodos] = useState([]);\n  \n  const addTodo = (text) => {\n    setTodos([...todos, { id: Date.now(), text, done: false }]);\n  };\n  \n  return (\n    <div>\n      {/* Todo implementation */}\n    </div>\n  );\n}\n\`\`\``,
                        'Casual Agent': `I'd be happy to help with that!\n\nBased on what you're asking, here's my thoughtful response: Life is a journey of continuous learning and growth. Whether you're planning a meal, seeking advice, or exploring new ideas, the key is to approach each moment with curiosity and openness.`,
                        'Travel Agent': `I'll help you plan your travel!\n\nBased on your request, let me suggest some amazing destinations and travel tips. Whether you're looking for adventure, relaxation, or cultural experiences, I can help you create the perfect itinerary.`,
                        'File Agent': `I'll analyze your file for you.\n\nBased on the file type and content, I can help you understand its structure, extract information, or perform specific operations on it.`,
                        'Browser Agent': `I'll help you navigate the web and find what you're looking for.\n\nI can search for information, fill out forms, or interact with websites on your behalf.`
                    };
                    
                    response = responses[agent] || 'I understand your request. Let me help you with that...';
                }
                
                const aiMessage = {
                    id: Date.now() + 1,
                    type: 'ai',
                    agent: agentDisplayNames[agent] || agent,
                    content: response,
                    timestamp: new Date()
                };
                
                setMessages(prev => [...prev, aiMessage]);
                
                // Update conversation context for follow-ups
                setConversationContext(prev => [...prev, {
                    user: message,
                    ai: response,
                    agent: agent
                }]);
            };
            
            // Handle key press
            const handleKeyPress = (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    handleSend();
                }
            };
            
            // Authentication Component
            if (!isAuthenticated) {
                return <AuthComponent onLogin={(token, username) => {
                    setIsAuthenticated(true);
                    setAuthToken(token);
                    setUsername(username);
                    localStorage.setItem('yappy_token', token);
                    localStorage.setItem('yappy_username', username);
                }} />;
            }
            
            return (
                <div className="min-h-screen bg-dark-bg flex flex-col">
                    {/* Main Container */}
                    <div className="flex-1 max-w-4xl mx-auto w-full px-3 sm:px-4 md:px-6 py-4 md:py-8 flex flex-col">
                        
                        {/* Greeting Section */}
                        <div className="text-center mb-8 md:mb-12 pt-4 md:pt-8">
                            <div className="inline-block">
                                <span className="starburst mb-2 md:mb-4 block text-xl md:text-2xl">âœ¦</span>
                            </div>
                            <h1 className="text-2xl sm:text-3xl md:text-4xl lg:text-5xl font-serif text-text-primary px-4">
                                {getGreeting()}, {username}
                            </h1>
                            {username !== 'there' && (
                                <p className="text-text-secondary mt-2 text-sm md:text-base">
                                    Welcome back to your AI assistant
                                </p>
                            )}
                        </div>
                        
                        {/* Messages Area */}
                        <div className="flex-1 overflow-y-auto mb-6 space-y-4 px-2 md:px-0">
                            {messages.map(message => {
                                if (message.type === 'system') {
                                    return (
                                        <div key={message.id} className="flex justify-center">
                                            <div className="text-xs md:text-sm text-text-secondary italic">
                                                {message.content}
                                            </div>
                                        </div>
                                    );
                                }
                                
                                return (
                                    <div key={message.id} className={`flex ${message.type === 'user' ? 'justify-end' : 'justify-start'}`}>
                                        <div className={`max-w-[85%] md:max-w-3xl px-3 md:px-4 py-2 md:py-3 rounded-lg ${
                                            message.type === 'user' 
                                                ? 'bg-dark-tertiary text-text-primary' 
                                                : 'bg-dark-secondary text-text-primary'
                                        }`}>
                                            {message.type === 'ai' && (
                                                <div className="text-orange-accent text-xs md:text-sm font-medium mb-1">
                                                    [{message.agent}]
                                                </div>
                                            )}
                                            <div className="whitespace-pre-wrap text-sm md:text-base">{message.content}</div>
                                            {/* Show attached file preview if it's an image */}
                                            {message.attachedFile && message.attachedFile.type.includes('image') && (
                                                <div className="mt-2">
                                                    <img 
                                                        src={message.attachedFile.content} 
                                                        alt={message.attachedFile.name}
                                                        className="max-w-full rounded-lg"
                                                        style={{ maxHeight: '300px' }}
                                                    />
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                );
                            })}
                            
                            {/* Loading indicator */}
                            {isLoading && (
                                <div className="flex justify-start">
                                    <div className="bg-dark-secondary px-4 py-3 rounded-lg">
                                        <div className="flex space-x-2">
                                            <div className="w-2 h-2 bg-text-secondary rounded-full loading-dot"></div>
                                            <div className="w-2 h-2 bg-text-secondary rounded-full loading-dot"></div>
                                            <div className="w-2 h-2 bg-text-secondary rounded-full loading-dot"></div>
                                        </div>
                                    </div>
                                </div>
                            )}
                            
                            <div ref={messagesEndRef} />
                        </div>
                        
                        {/* Uploaded Files Display */}
                        {uploadedFiles.length > 0 && (
                            <div className="mb-4 px-2 md:px-0">
                                <div className="text-xs text-text-secondary mb-2">Uploaded Files:</div>
                                <div className="flex flex-wrap gap-2">
                                    {uploadedFiles.map(file => (
                                        <div key={file.id} className="bg-dark-secondary px-3 py-1 rounded-full text-xs text-text-primary flex items-center gap-2">
                                            <span>{file.name}</span>
                                            <button
                                                onClick={() => {
                                                    setUploadedFiles(prev => prev.filter(f => f.id !== file.id));
                                                    setFileContext(prev => {
                                                        const newContext = { ...prev };
                                                        delete newContext[file.id];
                                                        return newContext;
                                                    });
                                                }}
                                                className="text-text-secondary hover:text-red-400 transition-colors"
                                            >
                                                <svg className="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                                                </svg>
                                            </button>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}
                        
                        {/* Input Section */}
                        <div className="bg-dark-secondary rounded-xl shadow-lg p-3 md:p-4">
                            <div className="flex flex-col md:flex-row md:items-center gap-3">
                                {/* Top row on mobile: Icons and Input */}
                                <div className="flex items-center flex-1 gap-2">
                                    {/* Left Icons - Now visible on all devices */}
                                    <div className="flex items-center space-x-1">
                                        {/* Hidden file input */}
                                        <input
                                            ref={fileInputRef}
                                            type="file"
                                            multiple
                                            onChange={handleFileUpload}
                                            className="hidden"
                                            accept="*/*"
                                        />
                                        
                                        {/* File Upload Button (Plus) */}
                                        <button 
                                            onClick={() => fileInputRef.current?.click()}
                                            className="text-text-secondary hover:text-text-primary p-2 transition-colors"
                                            title="Upload file"
                                        >
                                            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4" />
                                            </svg>
                                        </button>
                                        
                                    </div>
                                    
                                    {/* Input Field */}
                                    <input
                                        type="text"
                                        value={inputValue}
                                        onChange={(e) => setInputValue(e.target.value)}
                                        onKeyPress={handleKeyPress}
                                        placeholder="How can I help you today?"
                                        className="flex-1 bg-transparent text-text-primary placeholder-text-secondary outline-none min-w-0"
                                        disabled={isLoading}
                                    />
                                </div>
                                
                                {/* Bottom row on mobile: Model selector and Send */}
                                <div className="flex items-center gap-2">
                                    {/* Model Selector */}
                                    <div className="relative flex-1 md:flex-initial">
                                        <select 
                                            value={selectedModel}
                                            onChange={(e) => setSelectedModel(e.target.value)}
                                            className="w-full bg-dark-tertiary text-text-primary text-xs sm:text-sm rounded-lg px-2 md:px-3 py-2 outline-none cursor-pointer min-w-[100px]"
                                        >
                                            {modelOptions.map(model => (
                                                <option key={model} value={model}>{model}</option>
                                            ))}
                                        </select>
                                    </div>
                                    
                                    {/* Send Button */}
                                    <button
                                        onClick={() => handleSend()}
                                        disabled={isLoading || !inputValue.trim()}
                                        className="bg-orange-accent hover:bg-orange-600 disabled:opacity-50 disabled:cursor-not-allowed text-white rounded-full p-2 transition-all"
                                    >
                                        <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 10l7-7m0 0l7 7m-7-7v18" />
                                        </svg>
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        {/* Action Button Row */}
                        <div className="mt-4 md:mt-6 grid grid-cols-2 md:grid-cols-4 gap-2 md:gap-3">
                            {Object.keys(dropdownOptions).map(category => (
                                <div key={category} className="relative">
                                    <button
                                        onClick={() => setActiveDropdown(activeDropdown === category ? null : category)}
                                        className="w-full bg-dark-secondary hover:bg-dark-tertiary text-text-primary py-2 md:py-3 px-3 md:px-4 rounded-lg transition-all text-sm md:text-base"
                                    >
                                        {category}
                                    </button>
                                    
                                    {/* Dropdown Menu */}
                                    {activeDropdown === category && (
                                        <div className="absolute z-10 w-full bg-dark-tertiary rounded-lg shadow-xl overflow-hidden dropdown-enter md:mt-2 mb-2 md:mb-0 md:top-full bottom-full md:bottom-auto">
                                            {dropdownOptions[category].map(option => (
                                                <button
                                                    key={option}
                                                    onClick={() => handleDropdownSelect(category, option)}
                                                    className="w-full text-left px-3 md:px-4 py-2 md:py-3 text-text-primary hover:bg-dark-secondary transition-colors text-xs md:text-sm"
                                                >
                                                    {option}
                                                </button>
                                            ))}
                                        </div>
                                    )}
                                </div>
                            ))}
                        </div>
                        
                        {/* Logout Button */}
                        <div className="mt-6 text-center">
                            <button
                                onClick={() => {
                                    localStorage.removeItem('yappy_token');
                                    localStorage.removeItem('yappy_username');
                                    setIsAuthenticated(false);
                                    setAuthToken(null);
                                    setUsername('there');
                                    setMessages([]);
                                }}
                                className="text-text-secondary hover:text-text-primary text-sm"
                            >
                                Logout
                            </button>
                        </div>
                    </div>
                </div>
            );
        }
        
        // Authentication Component
        function AuthComponent({ onLogin }) {
            const [isLogin, setIsLogin] = useState(true);
            const [username, setUsername] = useState('');
            const [email, setEmail] = useState('');
            const [password, setPassword] = useState('');
            const [error, setError] = useState('');
            const [isLoading, setIsLoading] = useState(false);
            
            const handleSubmit = async (e) => {
                e.preventDefault();
                setError('');
                setIsLoading(true);
                
                try {
                    const endpoint = isLogin ? '/auth/login' : '/auth/register';
                    const payload = isLogin 
                        ? { username, password }
                        : { username, email, password };
                    
                    const response = await axios.post(endpoint, payload);
                    
                    if (response.data.access_token) {
                        // Pass both token and username to parent component
                        onLogin(response.data.access_token, response.data.username || username);
                    }
                } catch (err) {
                    setError(err.response?.data?.detail || 'An error occurred');
                } finally {
                    setIsLoading(false);
                }
            };
            
            return (
                <div className="min-h-screen bg-dark-bg flex items-center justify-center px-4">
                    <div className="max-w-md w-full">
                        <div className="text-center mb-8">
                            <span className="starburst mb-4 block">âœ¦</span>
                            <h1 className="text-3xl font-serif text-text-primary mb-2">
                                Welcome to Yappy
                            </h1>
                            <p className="text-text-secondary">
                                {isLogin ? 'Sign in to continue' : 'Create your account'}
                            </p>
                        </div>
                        
                        <form onSubmit={handleSubmit} className="bg-dark-secondary rounded-xl p-6 space-y-4">
                            {error && (
                                <div className="bg-red-900/20 border border-red-700 text-red-400 px-4 py-2 rounded-lg text-sm">
                                    {error}
                                </div>
                            )}
                            
                            <input
                                type="text"
                                placeholder="Username"
                                value={username}
                                onChange={(e) => setUsername(e.target.value)}
                                className="w-full bg-dark-tertiary text-text-primary px-4 py-3 rounded-lg outline-none focus:ring-2 focus:ring-orange-accent"
                                required
                            />
                            
                            {!isLogin && (
                                <input
                                    type="email"
                                    placeholder="Email"
                                    value={email}
                                    onChange={(e) => setEmail(e.target.value)}
                                    className="w-full bg-dark-tertiary text-text-primary px-4 py-3 rounded-lg outline-none focus:ring-2 focus:ring-orange-accent"
                                    required
                                />
                            )}
                            
                            <input
                                type="password"
                                placeholder="Password"
                                value={password}
                                onChange={(e) => setPassword(e.target.value)}
                                className="w-full bg-dark-tertiary text-text-primary px-4 py-3 rounded-lg outline-none focus:ring-2 focus:ring-orange-accent"
                                required
                            />
                            
                            <button
                                type="submit"
                                disabled={isLoading}
                                className="w-full bg-orange-accent hover:bg-orange-600 disabled:opacity-50 text-white py-3 rounded-lg font-medium transition-all"
                            >
                                {isLoading ? 'Loading...' : (isLogin ? 'Sign In' : 'Sign Up')}
                            </button>
                            
                            <div className="text-center text-text-secondary text-sm">
                                {isLogin ? (
                                    <>
                                        Don't have an account?{' '}
                                        <button
                                            type="button"
                                            onClick={() => {
                                                setIsLogin(false);
                                                setError('');
                                            }}
                                            className="text-orange-accent hover:text-orange-600"
                                        >
                                            Sign up
                                        </button>
                                    </>
                                ) : (
                                    <>
                                        Already have an account?{' '}
                                        <button
                                            type="button"
                                            onClick={() => {
                                                setIsLogin(true);
                                                setError('');
                                            }}
                                            className="text-orange-accent hover:text-orange-600"
                                        >
                                            Sign in
                                        </button>
                                    </>
                                )}
                            </div>
                            
                            {isLogin && (
                                <div className="mt-4 p-3 bg-dark-tertiary rounded-lg text-xs text-text-secondary">
                                    <strong>Demo Account:</strong><br />
                                    Username: admin<br />
                                    Password: yappy123
                                </div>
                            )}
                        </form>
                    </div>
                </div>
            );
        }
        
        // Render the app
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>